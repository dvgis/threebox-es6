<!DOCTYPE html>
<html>
<head>
	<title>Azure Maps Sample</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
	<link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css">
	<link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/indoor/0.1/atlas-indoor.min.css" type="text/css" />
	<script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.js"></script>

	<script src="../dist/threebox.js" type="text/javascript"></script>
	<link href="./css/threebox.css" rel="stylesheet" />
	<script src="config.js"></script>

	<script>

		if (!config) console.error("Config not set! Make a copy of 'config_template.js', add in your access token, and save the file as 'config.js'.");

		//Instantiate a map object
		var map;
		var levelControl;
		var indoorManager;
		const subscriptionKey = config.subscriptionKey;

		function GetMap() {

			//Instantiate a map object
			map = new atlas.Map("myMap", {
				center: [-122.3491, 47.6207, 0],
				subscriptionKey,
				zoom: 19,
				pitch: 60,
				bearing: 0,
				zoom: 16,
				style: "satellite",
				showBuildingModels: false
			});

			map.controls.add([
				new atlas.control.ZoomControl(),
				new atlas.control.CompassControl(),
				new atlas.control.PitchControl(),
				new atlas.control.StyleControl()
			], {
				position: "top-right"
			});

			let intMap = map.map;
			window.tb = new Threebox(
				intMap,
				intMap.getCanvas().getContext('webgl'),
				{
					realSunlight: true,
					//defaultLights: true,
					enableSelectingObjects: true, //change this to false to disable 3D objects selection
					enableDraggingObjects: true, //change this to false to disable 3D objects drag & move once selected
					enableRotatingObjects: true, //change this to false to disable 3D objects rotation once selected
					enableTooltips: true // change this to false to disable default tooltips on fill-extrusion and 3D models
				}
			);

			map.events.add("load", function (e) {

				intMap.addLayer({
					id: 'custom_layer',
					type: 'custom',
					renderingMode: '3d',
					onAdd: function (map, mbxContext) {
						let options = { obj: './models/landmarks/spaceneedle.glb', type: 'gltf', scale: 368.82, units: 'meters', rotation: { x: 90, y: 180, z: 0 }, anchor: 'center' }

						tb.loadObj(options, function (model) {
							model.setCoords([-122.349293, 47.620439]);
							model.castShadow = true;
							model.addTooltip("This is the Space Needle!!");
							tb.add(model);
						})

						options = { obj: './models/soldier.glb', type: 'gltf', scale: 100, units: 'meters', rotation: { x: 90, y: 0, z: 0 }, anchor: 'center' }
						tb.loadObj(options, function (model) {
							let soldier = model.setCoords([-122.347732, 47.6207, 0]);
							soldier.castShadow = true;
							soldier.addTooltip("Freaking soldier running!!");
							tb.add(soldier);
							soldier.playAnimation(options = { animation: 1, duration: 10000 });
						})
					},

					render: function (gl, matrix) {
						tb.update();
					}
				});

			});

		}

	</script>

	<style>
		html,
		body {
			width: 100%;
			height: 100%;
			padding: 0;
			margin: 0;
		}

		#myMap {
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body onload="GetMap()">
	<div id="myMap"></div>
</body>
</html>
